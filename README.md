# ha-windows-remote-service

A lightweight Windows Service (Native AOT) that exposes a REST API for controlling a Windows PC. Designed for use with the [ha-windows-remote](https://github.com/NeskireDK/ha-windows-remote) Home Assistant integration.

## Quick Start

1. Download the latest release from [Releases](https://github.com/NeskireDK/ha-windows-remote-service/releases)
2. Run the exe once â€” it auto-generates `appsettings.json` with a random API key
3. Install as a Windows Service:
   ```powershell
   sc create HaWindowsRemote binPath="C:\path\to\HaWindowsRemote.Service.exe"
   sc start HaWindowsRemote
   ```

## API

All endpoints except `/api/health` require the `X-Api-Key` header.

| Method | Route | Description | Status |
|--------|-------|-------------|--------|
| `GET` | `/api/health` | Health check (no auth) | Done |
| `POST` | `/api/system/sleep` | Suspend the PC | Done |
| `GET` | `/api/audio/devices` | List audio output devices | Planned |
| `GET` | `/api/audio/current` | Current default output device | Planned |
| `POST` | `/api/audio/set/{deviceName}` | Switch default output | Planned |
| `POST` | `/api/audio/volume/{level}` | Set master volume (0-100) | Planned |
| `GET` | `/api/monitor/profiles` | List saved monitor profiles | Planned |
| `POST` | `/api/monitor/set/{profile}` | Load a monitor profile | Planned |
| `POST` | `/api/app/launch/{appKey}` | Launch a predefined app | Planned |
| `POST` | `/api/app/kill/{appKey}` | Kill a predefined app | Planned |
| `GET` | `/api/app/status/{appKey}` | Check if app is running | Planned |

## Configuration

`appsettings.json` is auto-generated on first run:

```json
{
  "PcRemote": {
    "Port": 5000,
    "Auth": {
      "Enabled": true,
      "ApiKey": "<auto-generated>"
    },
    "ToolsPath": "./tools",
    "ProfilesPath": "./profiles"
  }
}
```

## Roadmap

- [x] Health endpoint
- [x] System sleep (P/Invoke SetSuspendState)
- [x] API key auth (auto-generated)
- [x] Native AOT build + GitHub Actions release
- [x] Unit tests (xUnit + Shouldly + FakeItEasy)
- [ ] Audio control (NirSoft SoundVolumeView)
- [ ] Monitor profiles (NirSoft MultiMonitorTool)
- [ ] App launch/kill management
- [ ] Linux support (systemd hosting)
- [ ] mDNS/Zeroconf discovery

## Building

```bash
dotnet build HaWindowsRemote.sln
dotnet test HaWindowsRemote.sln
dotnet publish src/HaWindowsRemote.Service -c Release -r win-x64 /p:PublishAot=true
```

## License

MIT
